## TODO

### 交易原则（保留原笔记）
- 真正的“方向确认”往往发生在：**结构突破（先） → 量能确认（次） → 均线发散（后）**
- **大周期定方向，小周期找切入**

### 问题定义：多信号冲突时听谁的？
你的代码会产出多个维度信号，实战中经常互相矛盾。

- 典型冲突场景：
  - 价格在 EMA50 上方（趋势偏多）
  - MACD 动能衰减（动能偏空）
  - RSI > 72（过热预警）

- 方向判定分歧：
  - 趋势交易者：方向仍向上，但需要回调
  - 均值回归交易者：可能认为即将向下

- 结论：技术线本身只提供素材，需要一个**裁判逻辑（打分系统 / 优先级规则）**来决定听谁的。

---

### NATR + BBW Z-Score 
| 指标      | 数值       | 会怎么说         |
| ------- | -------- | ------------ |
| NATR    | 高        | “波动大，风险高”    |
| BBW     | 很宽       | “趋势正在扩张”     |
| Z-Score | **+3.2** | **“你在极端偏离”** |

- 波动指标只描述“环境”，不描述“位置” NATR / BBW 完全防不了这个
- Z-Score 不参与“是不是趋势” 只参与“现在是不是好价位”

### allow_manage 何时可以 False？

只有在你遇到 必须全停 的极端情况，比如：
交易所/API 返回明显错误，价格/仓位数据不可信
账户状态未知（positions 读不到）
风控需要强制停机（比如系统异常）
这种才用 STOP_ALL + allow_manage=False。

作为 以后的优化项吧。
如果你想把它提升到“更像机构/职业化”的版本（最推荐的 5 个改动）
把 spread/depth/imbalance 阈值改成 rolling 分位数（跨币种立刻稳）
SOFT STOP 改成分级：degrade vs block（减少错杀）
risk_scale 连续化（避免边界跳变）
明确 order book 指标口径（depth 的定义固定）
把 gate 命中统计打通回测（用数据证明规则有效）

先把 imbalance 的定义标准化（比如 (bid-ask)/(bid+ask) 还是 bid/(bid+ask)）

然后在 debug 输出里长期观察分布，再定阈值
否则会出现：你以为是“极端”，其实是计算口径导致的“常态”。

reasons 建议分层输出（hard / gate / soft）而不是混在一起


空头成立需要的 4 件事（你这里全有）：

✅ 上一个趋势被暴力破坏

✅ 反抽失败（EMA 压制）

✅ 形成 lower high

✅ 下破反抽低点

1h 看大趋势   15m 看真正的趋势。 5m 精准入场 精准止损 提前发现“这笔单要不对劲了”


